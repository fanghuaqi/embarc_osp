<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>embARC: Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 50px;">
  <td id="projectlogo"><img alt="Logo" src="embARC_Logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectnumber">2017.12</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_library.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sect_lib_clib">C Library Support</a><ul><li class="level2"><a href="#sect_lib_clib_newlibc">ARC GNU Newlib</a></li>
<li class="level2"><a href="#sect_lib_clib_metawareclib">MetaWare C Run-Time Library</a></li>
</ul>
</li>
<li class="level1"><a href="#sect_lib_secureshield">SecureShield</a><ul><li class="level2"><a href="#sect_lib_secureshield_overview">Overview</a></li>
<li class="level2"><a href="#sect_lib_secureshield_terminology">Terminology</a></li>
<li class="level2"><a href="#sect_lib_secureshield_steps">Steps to Create a SecureShield Application</a></li>
<li class="level2"><a href="#sect_lib_secureshield_application">SecureShield Application Examples</a><ul><li class="level3"><a href="#subsect_lib_secureshield_application_feature_app">SecureShield Feature Example</a></li>
<li class="level3"><a href="#subsect_lib_secureshield_application_secret_app">SecureShield Secret Example</a></li>
<li class="level3"><a href="#subsect_lib_secureshield_application_tinydtls_client_app">SecureShield TinyDTLS Client Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="sect_lib_clib"></a>
C Library Support</h1>
<p>Provide support for file-related APIs using FatFs, printf() support using a UART, and time-related APIs. For details, please refer to the source code library/clib. The C library support implemented in embARC is compatible with both the GNU toolchain for ARC Processors and the MetaWare Development Toolkit C library implementations (each included in their respective toolchain package). More information on each C library is included below. </p>
<h2><a class="anchor" id="sect_lib_clib_newlibc"></a>
ARC GNU Newlib</h2>
<p><a href="https://sourceware.org/newlib/">Newlib</a> is a C standard library implementation intended for use on embedded systems. It is a conglomeration of several library parts, all under <a href="https://sourceware.org/newlib/COPYING.NEWLIB">free software licenses</a> that make them easily usable on embedded products.</p>
<p>It was created by Cygnus Support as part of building the first GNU cross-development toolchains. It is now maintained by Red Hat developers Jeff Johnston and Corinna Vinschen, and is used in most commercial and non-commercial GCC ports for non-Linux embedded systems.</p>
<h2><a class="anchor" id="sect_lib_clib_metawareclib"></a>
MetaWare C Run-Time Library</h2>
<p>The MetaWare C Run-Time Library is a collection of functions, macros, and type declarations organized into header files according to ANSI Standard C Library areas, such as mathematics and string handling. The MetaWare C Run-Time Library is an ANSI Standard C library with extensions. The macros, function names and parameters, and types are those dictated by the ANSI C Standard. The library conforms to the ANSI C Standard (ANSI document X3J11/90-014); the single-precision math functions conform to the ISO/ANSI C99 Standard. The library also provides additional functions not described in the ANSI C Standard.</p>
<h1><a class="anchor" id="sect_lib_secureshield"></a>
SecureShield</h1>
<h2><a class="anchor" id="sect_lib_secureshield_overview"></a>
Overview</h2>
<p>SecureShield enables the execution of applications in isolated, Trusted Execution Environments (TEE). Multiple, isolated environments can run on a single core. The SecureShield runtime is a microvisor implementation that provides the required isolation, enforced by processor privilege levels and the memory-protection unit (MPU). Depending on the level of trust for the application, each execution environment can be given or denied access to system resources like memory, memory-mapped I/O, CPU control registers, and APEX extension instructions and registers.</p>
<p> 
<div class="imagebox">
    <div style="width: 600px">
        <img src="pic/secureshield_overview.jpg" alt="SecureShield Overview"/>
        <p>SecureShield Overview</p>
    </div>
</div>
 <h2><a class="anchor" id="sect_lib_secureshield_terminology"></a>
Terminology</h2>
<h2>SecureShield runtime</h2>
<p>A microvisor implementation for ARC EM Processors with MPU to manage containers, analogous to RTOS kernel managing tasks </p><h2>Container</h2>
<p>A container defines a sandbox for an application. The container provides the trusted execution environment for application code runs in. Containers are designed to be isolated from each other. Each container has its own space attributes, including the stack area (required), context area (optional), resources (peripherals, interrupt, auxiliary registers). A container context is the memory area that is used for the container itself; its type is defined in the container configuration.</p>
<p>The SecureShield runtime supports two types of containers: secure containers and normal containers.</p>
<p> 
<div class="imagebox">
    <div style="width: 600px">
        <img src="pic/secureshield_containers.jpg" alt="Containers in SecureShield"/>
        <p>Containers in SecureShield</p>
    </div>
</div>
 <h3>Secure Containers</h3>
<p>Secure containers have a secure privilege level, meaning that Secure containers are trusted and can access all the resources in the system. Bugs or malware in a secure container can compromise the system so a container that is configured as secure can not be changed at runtime. </p><h3>Normal Containers</h3>
<p>Normal containers have a normal privilege level, meaning that their access to system resources is limited. Normal containers are only allowed to access the resources allocated to them. If they attempt to access other resources, a violation exception is raised. </p><h3>Background Container</h3>
<p>The background container is a special normal container whose resources are shared to all the other containers. It has no context area, and its stack is the original application stack when SecureShield is not enabled.</p>
<h2>Resources</h2>
<p>The core concept in SecureShield is that a container can only access resources that have been explicitly allocated to it. </p><h3>Memory Mapped Resources</h3>
<p>The memory mapped resources are resources that are mapped into memory address space, e.g. ram, rom, peripherals (UART/I2/SPI). Memory mapped resources are isolated and protected by the MPU. </p><h3>System Resources</h3>
<p>System resources are resources that are not isolated and protected by MPU, e.g., interrupts, exceptions, registers, APEX. System resources are isolated and protected by the processor privilege level. Secure system resources require secure privilege level and can be allocated to normal containers; normal system resources require normal privilege level and are shared to all containers.</p>
<p>System resources APIs are used by normal containers to access secure system resources. Because secure containers have secure privilege level, then can access secure system resources directly.</p>
<h3>Container Interfaces</h3>
<p>A container can provide services to other containers through an interface. An interface is a C function with parameters and return value registered in an access control table.</p>
<p>As shown below, a container can call the interface of another container through container call. The container interface will be executed in the context of callee container.</p>
<p> 
<div class="imagebox">
    <div style="width: 600px">
        <img src="pic/secureshield_container_interface.jpg" alt="Container interface"/>
        <p>Container interface</p>
    </div>
</div>
 <p>Background container has no interfaces as it is a global shared container, i.e., regular C function calls can be performed.</p>
<h3>Resources of a container</h3>
<p>A container has implicit resources: code sections (.text, .rodata, .bss, .data) and stack; as well as explicit resources defined in an access control table, e.g., memory mapped resources, system resources and container interfaces</p>
<h4>Access Control Table</h4>
<p>The privileges that a container has to access the system are defined via Access Control (AC).</p>
<p>Each container has a table that defines the allocated resources and privilege level, including memory, interrupts, and peripherals. This table is referred to as the access-control table or access-control list.</p>
<p>Each item in this table or list is called an access-control item. An access control item has the type access control, and additional attributes that constitute a triplet: {attribute1, attribute2, type|access}. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;typedef struct</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    void* param1;       /* address parameter or function pointer */</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    uint32_t param2;    /* size or no. */</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    CONTAINER_AC ac;    /* resource type, access control types */</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;} EMBARC_PACKED CONTAINER_AC_ITEM;</div></div><!-- fragment --><p>An access-control table example is shown below:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;static CONTAINER_AC_TABLE g_container_act[] = {</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    {(void *)(PERIPHERAL_ADDR_BASE + REL_REGBASE_PINMUX), 0x1000, SECURESHIELD_ACDEF_UPERIPH}, // memory mapper peripheral, {start_address, size in bytes, type | access}</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    {(void *)0x10000, 0x1000, SECURESHIELD_ACDEF_URAM}, // memory, {start_address, size in bytes, type | access}</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    {default_interrupt_handler, INTNO_GPIO, SECURESHIELD_AC_IRQ}, // system resources-interrupt, {interrupt handler, interrupt no, type}</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    {(void *)0x21, 0x3, SECURESHIELD_AC_AUX}, // system resources-auxiliary registers, {start_address, size, type}</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    {tst_func4, 4, SECURESHIELD_AC_INTERFACE}, // container interface, {interface handler, number of interface handler arguments, type}</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;};</div></div><!-- fragment --><p>According to this access control table, the container is allocated the peripheral area of PIN_MUX, a 0x1000 bytes ram region starting from 0x10000, a GPIO interrupt (INTNO_GPIO), an auxiliary-register area starting from 0x21 with a size of 03. The container also has an interface (tst_func4) to provide the service with 4 arguments in the interface handler function</p>
<p>The resource type describes the kind of resource, such as interrupt, register, or memory. The access-control attribute describes how it is accessed: secure or normal, read/write/execute. The detailed definitions of resource type and access-control attribute is listed as follow.</p>
<table class="doxtable">
<tr>
<th align="center">Basic Resource Type </th><th align="center">Parameters </th><th align="center">Comments  </th></tr>
<tr>
<td align="center">SECURESHIELD_AC_MEMORY </td><td align="center">(start_address, size) </td><td align="center"></td></tr>
<tr>
<td align="center">SECURESHIELD_AC_PERIPHERAL </td><td align="center">(start_address, size) </td><td align="center">Currently, only memory-mapped peripherals are supported </td></tr>
<tr>
<td align="center">SECURESHIELD_AC_IRQ </td><td align="center">(interrupt_handler, interrupt no) </td><td align="center"></td></tr>
<tr>
<td align="center">SECURESHIELD_AC_AUX </td><td align="center">(aux start address, size) </td><td align="center">AUX is in auxiliary address space </td></tr>
<tr>
<td align="center">SECURESHIELD_AC_INTERFACE </td><td align="center">(interface_handler, arguments number) </td><td align="center">No extra resource attribute </td></tr>
</table>
<table class="doxtable">
<tr>
<th align="center">Basic Resource Access Attribute </th><th align="center">Comments  </th></tr>
<tr>
<td align="center">SECURESHIELD_AC_UEXECUTE </td><td align="center">Execution with user privilege </td></tr>
<tr>
<td align="center">SECURESHIELD_AC_UWRITE </td><td align="center">Write with user privilege </td></tr>
<tr>
<td align="center">SECURESHIELD_AC_UREAD </td><td align="center">Read with user privilege </td></tr>
<tr>
<td align="center">SECURESHIELD_AC_KEXECUTE </td><td align="center">Execution with kernel privilege </td></tr>
<tr>
<td align="center">SECURESHIELD_AC_KWRITE </td><td align="center">Write with kernel privilege </td></tr>
<tr>
<td align="center">SECURESHIELD_AC_KREAD </td><td align="center">Read with kernel Privilege </td></tr>
</table>
<table class="doxtable">
<tr>
<th align="center">Extended Resource Access Attribute </th><th align="center">Comments  </th></tr>
<tr>
<td align="center">SECURESHIELD_AC_SIZE_ROUND_UP </td><td align="center">the resource size should be rounded up </td></tr>
<tr>
<td align="center">SECURESHIELD_AC_SIZE_ROUND_DOWN </td><td align="center">the resource size should be rounded down </td></tr>
<tr>
<td align="center">SECURESHIELD_AC_SHARED </td><td align="center">the resource is a shared resource (no implementation now) </td></tr>
<tr>
<td align="center">SECURESHIELD_AC_SECURE </td><td align="center">the resource is a secure resource </td></tr>
<tr>
<td align="center">SECURESHIELD_AC_NORMAL </td><td align="center">the resource is a normal resource </td></tr>
</table>
<p>More details can be found in secureshield_vmpu_exports.h. For some resources, there are pre-defined CONTAINER_AC, e.g., SECURESHIELD_ACDEF_U/KROM, SECURESHIELD_ACDEF_U/KRAM.</p>
<h2>Secure Call</h2>
<p>In SecureShield, a secure call is implemented as a section of assembly code and invoked as a normal function call. The secure call is the only communication interface for a container to call the SecureShield runtime services. The following SecureShield runtime services are provided:</p><ul>
<li>container call: call the services provided by other containers</li>
<li>interrupt management: see secureshield_int_exports.h</li>
<li>auxiliary-register access and benchmark function: see secureshield_sys_ops_exports.h</li>
</ul>
<p> 
<div class="imagebox">
    <div style="width: 600px">
        <img src="pic/secureshield_secure_call.jpg" alt="Secure call"/>
        <p>Secure call</p>
    </div>
</div>
 <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#define SECURESHIELD_SECURE_CALL(id, metadata, ...) \</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    ({ \</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;        SECURESHIELD_MACRO_REGS_ARGS(uint32_t, ##__VA_ARGS__) \</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;        SECURESHIELD_MACRO_REGS_RETVAL(uint32_t, res) \</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        Asm( \</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;            &quot;SECURE_INSTN %[secure_call_id]\n&quot; \</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;            metadata \</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;            : SECURESHIELD_MACRO_ASM_OUTPUT(res) \</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;            : SECURESHIELD_MACRO_ASM_INPUT(__VA_ARGS__), \</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;            [secure_call_id] &quot;i&quot; (id) \</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        ); \</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        res; \</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    })</div></div><!-- fragment --><p>If SECURESHIELD_VERSION == 1, SECURE_INSTN is <b>trap_s</b>; If SECURESHIELD_VERSION == 2, SECURE_INSTN is <b>sjli</b>.</p>
<h3>Container Call</h3>
<p>Although containers are isolated from each other, a container can provide services to other containers through container interface. The container interface must first be registered in the access control table. The background container has no interface as its resources are shared to all other containers.</p>
<p>To call a container interface, container all is required. The following is an example.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;int tst_func2(int arg1, int arg2)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;        return arg1+arg2;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;}</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;static const CONTAINER_AC_ITEM g_container1_act[] = {</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        {tst_func, 2, SECURESHIELD_AC_INTERFACE}</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;};</div></div><!-- fragment --><p>In the above code, container1 has one interface named tst_func2 with two arguments to provide services. If other containers want to call this service, the following container call should be made:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ret = container_call(container1, tst_func2, 1, 2);</div></div><!-- fragment --><p>1 and 2 are arguments passed to tst_fun2, ret is the return value of tst_func.</p>
<p>The <b>container_call</b> will be expanded into the following assembly.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    mov r0, 1</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    mov r1, 2</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    SECURE_INSTN SECURESHIELD_SECURE_CALL_CONTAINER_IN</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    b skip_args1</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    .long SECURESHIELD_CONTAINER_CALL_MAGIC</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    .long tst_func2</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    .long container1_cfg_prt</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;skip_args1:</div></div><!-- fragment --><p>Container calls can be nested, i.e., in a container interface, another container call can be made.</p>
<p> 
<div class="imagebox">
    <div style="width: 600px">
        <img src="pic/secureshield_container_call.jpg" alt="Container call"/>
        <p>Container call</p>
    </div>
</div>
 <p>It should be noted that container call should not be made in the interrupt and exception handler. Because SecureShield runtime is not integrated with OS, in the container call which will cause container switch, task scheduler should be disabled to avoid task switch.</p>
<h2>Memory Map</h2>
<p>The memory map of a SecureShield application is shown as follow. There are two worlds, secure world and normal world. The normal world, consisting of normal containers, is in normal memory (normal rom and ram). The secure world, consisting of secure containers, is in secure memory (secure rom and ram). In each world, containers are isolated with each other through MPU, an address alignment is also required. Besides secure containers, SecureShield runtime, can be viewed as a special secure container, is in secure memory with a fixed position. SecureShiled runtime will be compiled and linked independently with the application, so it's a black box to application.</p>
<p> 
<div class="imagebox">
    <div style="width: 600px">
        <img src="pic/secureshield_memory_map.jpg" alt="SecureShield application memory map"/>
        <p>SecureShield application memory map</p>
    </div>
</div>
 <h2>Compile and Link Flow</h2>
<p>Different with common one shot compile and link, there are two compiles and links in SecureShiled application, one for SecureShield runtime, one for application.</p>
<h3>Phase1: SecureShield runtime compile and link</h3>
<p>The compile and link flow is shown as follow</p>
<p> 
<div class="imagebox">
    <div style="width: 800px">
        <img src="pic/secureshield_1st_compile.jpg" alt="SecureShiled runtime compile and link"/>
        <p>SecureShiled runtime compile and link</p>
    </div>
</div>
 <h3>Phase2: Application compile and link</h3>
<p>The compile and link flow is shown as follow</p>
<p> 
<div class="imagebox">
    <div style="width: 800px">
        <img src="pic/secureshield_2nd_compile.jpg" alt="Application compile and link"/>
        <p>Application compile and link</p>
    </div>
</div>
 <h2><a class="anchor" id="sect_lib_secureshield_steps"></a>
Steps to Create a SecureShield Application</h2>
<h2>Step1: makefiles</h2>
<ul>
<li>LIB_SEL += secureshield, select SecureShield library</li>
<li>LIB_SECURESHIELD_VERSION<ul>
<li>=1 for the EM with legacy MPU</li>
<li>=2 for the EM SilverStone</li>
</ul>
</li>
<li>-DLIB_SECURESHIELD_OVERRIDES, this definition will enable override mechanism which will override the ARC HAL API in <a class="el" href="arc__exception_8h.html" title="header file of exception and interrupt management module ">arc_exception.h</a>, <a class="el" href="arc__builtin_8h.html" title="header file of builtin and helper functions ">arc_builtin.h</a> and <a class="el" href="arc__exception_8h.html" title="header file of exception and interrupt management module ">arc_exception.h</a> with the secureshield API</li>
<li>APPL_SECURE_CSRC_DIR (optional), the directories of C source files which need to be compiled and linked with SecureShield runtime</li>
<li>SECURE_SYMBOL_LIST (optional ), the file of symbols need to be exported to normal application from secure binary</li>
</ul>
<h2>Step2: Container Memory Configuration File (secureshield_appl_config.h)</h2>
<p>secureshield_appl_config.h includes the application information to generate the correct memory map</p><ul>
<li>SECURE_REGION_CONTAINERS_ROM : the regions need to be generated in NORMAL_ROM</li>
<li>SECURE_REGION_CONTAINERS_RAM : the regions need to be generated in NORMAL_RAM</li>
<li>SECURE_REGION_CONTAINERS_SCURE_ROM : the regions need to be generated in SECURE_ROM (secure containers only)</li>
<li>SECURE_REGION_CONTAINERS_SECURE_RAM : the regions need to be generated in SECURE_RAM (secure containers only) <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;/* tell linker script template the rom region information of containers */</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;#define SECURESHIELD_REGION_CONTAINERS_ROM \</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;                    GEN_CONTAINER_ROM_SECTION(container1, 2048, *container1.o*)</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;/* tell linker script template the ram region information of containers */</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;#define SECURESHIELD_REGION_CONTAINERS_RAM \</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;                    GEN_CONTAINER_RAM_SECTION(container1, 2048, *container1.o*)  </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;// 2048 is the size of container region, it&#39;s required and computed according to the application if LIB_SECURESHIELD_VERSION = 1 </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;// If LIB_SECURESHIELD_VERSION = 2, size can be ignored</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;// container1.o is the object file whose relative code sections need to put in the container region</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;// multiple object files can be put in this macro</div></div><!-- fragment --></li>
</ul>
<p>The above code segment will generate the following sections in final linker script if LIB_SECURESHIELD_VERSION=2</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;.rom.container1 ALIGN(128): {</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    _f_text_container1 = .;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    *(.text.container1)</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &quot;*container1.o*&quot;(TYPE text)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    . = ALIGN(128);</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    _e_text_container1 = .;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    _f_rodata_container1 = .;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    *(.rodata.container1)</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &quot;*container1.o*&quot;(TYPE lit)</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    . = ALIGN(128);</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    _e_rodata_container1 = .; </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    } &gt; NORMAL_ROM</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;.ram.data.container1 ALIGN(128) : { </div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        _f_data_container1 = .;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;         *(.data.container1)</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;          &quot;*container1.o*&quot;(TYPE data)</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;           _e_data_container1 = .; </div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    } &gt; NORMAL_RAM AT &gt; NORMAL_ROM</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;.ram.bss.container1 : {</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;      _f_bss_container1 = .;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;       *(.bss.container1)</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        &quot;*container1.o*&quot;(TYPE BSS)</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;         . = ALIGN(128);</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;          _e_bss_container1 = .; </div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    } &gt; NORMAL_RAM</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    _f_data_load_container1 = LOADADDR(.ram.data.container1);</div></div><!-- fragment --><h2>Step3:Container Access Control Configuration</h2>
<p>The container access control configuration is recommended to be in a specific file named container_cfg.c</p>
<h2>Step4: Coding</h2>
<p>A recommended SecureShield application is :</p><ul>
<li>one container, one source file or directory, e.g container1 in container1.c</li>
<li>files compiled with SecureShield runtime are in specific directory, e.g. secure</li>
</ul>
<h2>Step5: Define the exported secure symbols</h2>
<p>secure_symbol.txt contains the symbols (container interface) exported to normal application from secure binary. This file is only required when normal application needs to call the symbol in secure binary. It also needs to be defined in makefile.</p>
<p>For example, the following container (container4) will be compiled and linked with secure binary, it has two interfaces: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;static CONTAINER_AC_TABLE g_container4_act[] = {</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    {tst_func_sec1, 0, SECURESHIELD_AC_INTERFACE},</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    {tst_func_sec2, 0, SECURESHIELD_AC_INTERFACE}</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;};</div></div><!-- fragment --><p>Then the secure_symbol.txt should be </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;tst_func_sec1</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;tst_func_sec2</div></div><!-- fragment --><h2>Step6: Compile and Debug</h2>
<p>Upon compiling and linking, the following files will be generated: linker_xx.ldf: the generated linker script for normal application the generated linker script for secure binary secureshield_secure.bin/elf: secure binary secureshield_secure.syms (MWDT only): the exported secure symbol list</p>
<h2><a class="anchor" id="sect_lib_secureshield_application"></a>
SecureShield Application Examples</h2>
<p>There are several SecureShield application examples include in the embARC OSP distribution.</p><ul>
<li><a class="el" href="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___s_e_c_u_r_e_s_h_i_e_l_d___t_e_s_t___c_a_s_e.html">baremetal/secureshield/test_case</a> demonstrates and tests the features of SecureShield.</li>
<li><a class="el" href="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___s_e_c_u_r_e_s_h_i_e_l_d___s_e_c_r_e_t___s_e_c_u_r_e.html">baremetal/secureshield/secret_secure</a> and its derived example <a class="el" href="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___s_e_c_u_r_e_s_h_i_e_l_d___s_e_c_r_e_t___n_o_r_m_a_l.html">baremetal/secureshield/secret_normal</a> <a class="el" href="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___s_e_c_u_r_e_s_h_i_e_l_d___s_e_c_r_e_t___s_e_c_u_r_e___s_i_d.html">baremetal/secureshield/secret_secure_sid</a>shows examples of a secret being protected by a password.</li>
</ul>
<h3><a class="anchor" id="subsect_lib_secureshield_application_feature_app"></a>
SecureShield Feature Example</h3>
<p>The test_case serves as a unit test of secureshield features. All features provided by secureshield are simply tested in this example.</p>
<h3><a class="anchor" id="subsect_lib_secureshield_application_secret_app"></a>
SecureShield Secret Example</h3>
<p>This example is designed to show how to protect data using secureshield.</p>
<p>As shown below, the secret is protected in container, user needs to input the right password to get the secret. Container2 is trusted by container1, and thus does not need the password to get the secret.</p>
<p>The secret example shows how to use container separation, container check and secure container, and how to define application specific linker script.</p>
<p> 
<div class="imagebox">
    <div style="width: 600px">
        <img src="pic/secureshield_secret.jpg" alt="SecureShield secret example"/>
        <p>SecureShield secret example</p>
    </div>
</div>
 <h3><a class="anchor" id="subsect_lib_secureshield_application_tinydtls_client_app"></a>
SecureShield TinyDTLS Client Example</h3>
<p>In IoT applications, communication between nodes is typically secured by TLS (for TCP) or DTLS (for UDP). For TLS and DTLS, the critical parts are keys, certification files, and TRNG. If these critical parts are compromised (read or written without permission), secure communication is at risk.</p>
<p> 
<div class="imagebox">
    <div style="width: 600px">
        <img src="pic/secureshield_tinydtls.jpg" alt="SecureShield tinydtls example"/>
        <p>SecureShield tinydtls example</p>
    </div>
</div>
 <p>This example is a SecureShield-protected secure communication demo, where the key and TRNG device (optional) required by the AES128_CCM protocol are located in container 1 and isolated with application in container 0. The container call is the only entry to access the key data. In the container call, a check is done to only allow the specific container and function to access the key data.</p>
<p>If malware tries to bypass the check in the container call and directly access the key data, an exception is raised. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Apr 27 2018 04:04:51 for embARC by
    <a href="http://www.synopsys.com">
    <img class="footer" src="pic/snps_logo.png" alt="snps_logo"/></a>. All Rights Reserved. </li>
  </ul>
</div>
</body>
</html>
